HOME=.
LIB=$(HOME)\..\AMFICOMCommon
LIBSRC=$(HOME)\..\AMFICOMCommon\src
ORACLE_HOME=d:\oracle\ora91
SRC=$(HOME)\src
CLASSES=$(HOME)\classes
IDL=$(HOME)\idl

#IDL2JAVA=$(ORACLE_HOME)\bin\idl2java
IDL2JAVA=idlj
#IDL2JAVAOPTIONS=-no_examples -no_tie -root_dir $(SRC)
IDL2JAVAOPTIONS=-i .\idl -fallTIE -td $(SRC)
JAVAC=javac
JAR=jar

LIBNAME=$(LIB)\corba.jar
LIBNAME_SRC=$(LIBSRC)\corbasource.jar

.PHONY:	$(LIBNAME)

$(LIBNAME):	clean object server2 jar

jar:
	$(JAR) -cf $(LIBNAME) -C $(CLASSES) com
	$(JAR) -cf $(LIBNAME_SRC) -C $(SRC) com

object:	alllibs
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\AMFICOM.idl
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\client.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) \
		$(SRC)\com\syrus\AMFICOM\CORBA\_AMFICOMClientStub.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClient.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClientHelper.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClientHolder.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClientOperations.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClientPOA.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMClientPOATie.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) \
		$(SRC)\com\syrus\AMFICOM\CORBA\_AMFICOMStub.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOM.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMHelper.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMHolder.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMOperations.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMPOA.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\AMFICOMPOATie.java

server2: event config measurement mcm

mcm: general config measurement
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\cmserver.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\cmserver\corba\*.java

event:
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\event.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\event\corba\*.java

config: general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\configuration.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\configuration\corba\*.java

measurement: event general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\measurement.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\measurement\corba\*.java

alllibs: general admin alarm network ism map scheme survey report

ism:	general network
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\ISM.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\ISM\*.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\ISMDirectory\*.java

map:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\map.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Map\*.java

scheme:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\scheme.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Scheme\*.java

survey:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\survey.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Survey\*.java

network: general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\network.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Network\*.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\NetworkDirectory\*.java

report:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\report.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Report\*.java

admin:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\admin.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Admin\*.java

alarm:	general
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\alarm.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Alarm\*.java

general:
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\general.idl
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\resource.idl
	$(IDL2JAVA) $(IDL2JAVAOPTIONS) $(IDL)\constants.idl
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\General\*.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Resource\*.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) $(SRC)\com\syrus\AMFICOM\CORBA\Constant\*.java
	$(JAVAC) -d $(CLASSES) -sourcepath $(SRC) \
		$(SRC)\com\syrus\AMFICOM\CORBA\Constants.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\ConstantsHelper.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\ConstantsHolder.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\ConstantsOperations.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\ConstantsPOA.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\ConstantsPOATie.java \
		$(SRC)\com\syrus\AMFICOM\CORBA\_ConstantsStub.java

clean:
	rm -rf $(CLASSES)\com\syrus\AMFICOM
	rm -rf $(SRC)\com\syrus\AMFICOM
	rm -f $(ALL_LIBS) $(LIBNAME) $(LIBNAME_SRC)
