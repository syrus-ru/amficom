HOME=.
LIB=$(HOME)\..\AMFICOMCommon
LIBSRC=$(HOME)\..\AMFICOMCommon\src
EXTLIB=d:\lib91
ORACLE_HOME=d:\oracle\ora91
SRC=$(HOME)\src
CLASSES=$(HOME)\classes

LAYOUTCLASSPATH=$(EXTLIB)\layout.jar
VBJCLASSPATH=$(ORACLE_HOME)\lib\vbjorb.jar;$(ORACLE_HOME)\lib\vbjapp.jar;$(ORACLE_HOME)\lib\aurora_client.jar
SQLJCLASSPATH=$(ORACLE_HOME)\sqlj\lib\runtime12.jar;$(ORACLE_HOME)\sqlj\lib\translator.jar
JDBCCLASSPATH=$(ORACLE_HOME)\jdbc\lib\classes12.jar

PROJECTCLASSPATH=$(LIB)\server\kisserver.jar;$(LIB)\server\utilserver.jar;$(LIB)\util.jar;$(LIB)\io.jar;$(LIB)\corba_portable.jar;$(LIB)\server\serveradd.jar

SERVERHOSTNAME=research
CONNECTSTRING=shaitan

CHECKSEMANTICSSTRING=
#CHECKSEMANTICSSTRING=-u amficom/amficom -url=jdbc:oracle:thin:@$(SERVERHOSTNAME):1521:$(CONNECTSTRING)

JAR_OBJECT=$(LIB)\ServerObjectInterface.jar
JAR_ADMIN=$(LIB)\ServerInterface_Admin.jar
JAR_ALARM=$(LIB)\ServerInterface_Alarm.jar
JAR_GENERAL=$(LIB)\ServerInterface_General.jar
JAR_ISM=$(LIB)\ServerInterface_ISM.jar
JAR_MAP=$(LIB)\ServerInterface_Map.jar
JAR_NETWORK=$(LIB)\ServerInterface_Network.jar
JAR_REPORT=$(LIB)\ServerInterface_Report.jar
JAR_SCHEME=$(LIB)\ServerInterface_Scheme.jar
JAR_SURVEY=$(LIB)\ServerInterface_Survey.jar
SERVERINTERFACECLASSPATH=$(JAR_OBJECT);$(JAR_ADMIN);$(JAR_ALARM);$(JAR_GENERAL);$(JAR_ISM);$(JAR_MAP);$(JAR_NETWORK);$(JAR_REPORT);$(JAR_SCHEME);$(JAR_SURVEY)

MYCLASSPATH=$(CLASSES);$(VBJCLASSPATH);$(SQLJCLASSPATH);$(JDBCCLASSPATH);$(SERVERINTERFACECLASSPATH);$(PROJECTCLASSPATH);$(LAYOUTCLASSPATH)

SQLJ=$(ORACLE_HOME)\bin\sqlj
JAVAC2=D:\java\j2sdk_nb\j2sdk1.4.2\bin\javac
JAVAC=javac
JAVACOPTIONS=-d $(CLASSES) -sourcepath $(SRC) -classpath $(MYCLASSPATH)
SQLJOPTIONS=-compiler-executable=$(JAVAC) -warn=none -codegen=oraclejdbc -ser2class -status $(CHECKSEMANTICSSTRING) -d $(CLASSES) -dir $(SRC) -classpath $(MYCLASSPATH)
JAR=jar

LIBNAME=$(LIB)\server\serveradd.jar
LIBNAME_SRC=$(LIBSRC)\serveraddsource.jar

.PHONY:	$(LIBNAME)

$(LIBNAME):	add jar

jar:
	$(JAR) -cf $(LIBNAME) \
		-C $(CLASSES) com\syrus\AMFICOM\server\prefs\JDBCConnectionManager.class \
		-C $(CLASSES) com\syrus\AMFICOM\server\ConnectionManager.class \
		-C $(CLASSES) com\syrus\AMFICOM\server\LogWriter.class \
		-C $(CLASSES) com\syrus\AMFICOM\server\QueryBuilder.class \
		-C $(CLASSES) com\syrus\AMFICOM\server\ResourcedbInterface.class \
		-C $(CLASSES) "com\syrus\AMFICOM\server\ResourcedbInterface$$ImageResourceIterator.class" \
		-C $(CLASSES) "com\syrus\AMFICOM\server\ResourcedbInterface$$ResourceDescriptorIterator.class" \
		-C $(CLASSES) "com\syrus\AMFICOM\server\ResourcedbInterface$$ResultDescriptorIterator.class" \
		-C $(CLASSES) com\syrus\AMFICOM\server\StubLogWriter.class
	$(JAR) -cf $(LIBNAME_SRC) -C $(SRC) com

add:
	$(JAVAC) $(JAVACOPTIONS) \
		$(SRC)\com\syrus\AMFICOM\server\prefs\JDBCConnectionManager.java \
		$(SRC)\com\syrus\AMFICOM\server\ConnectionManager.java \
		$(SRC)\com\syrus\AMFICOM\server\LogWriter.java \
		$(SRC)\com\syrus\AMFICOM\server\QueryBuilder.java \
		$(SRC)\com\syrus\AMFICOM\server\StubLogWriter.java

	$(SQLJ) $(SQLJOPTIONS) \
		$(SRC)\com\syrus\AMFICOM\server\ResourcedbInterface.sqlj


clean:
	rd /s /q $(CLASSES)\com\syrus\AMFICOM\server
	del /f /q $(LIBNAME)
